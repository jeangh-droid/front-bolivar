<ng-container *ngIf="currentUserRole$ | async as role">

  <div class="d-flex vh-100">

    <!-- ===================== SIDEBAR ===================== -->
    <aside class="d-flex flex-column flex-shrink-0 p-3 text-white bg-dark shadow-lg" style="width: 270px;">
      
      <!-- Logo / Título -->
      <a routerLink="/dashboard" class="d-flex align-items-center mb-3 mb-md-0 text-white text-decoration-none">
        <i class="bi bi-shop-window fs-3 me-2"></i>
        <span class="fs-4 fw-bold">Mercado Bolívar</span>
      </a>
      <hr>

      <!-- Menú -->
      <ul class="nav nav-pills flex-column mb-auto">

        <!-- Inicio -->
        <li class="nav-item">
          <a routerLink="/dashboard"
             routerLinkActive="active"
             [routerLinkActiveOptions]="{exact: true}"
             class="nav-link text-white sidebar-link">

            <i class="bi bi-house-fill me-2"></i> Inicio
          </a>
        </li>

        <!-- Menú por Rol -->
        <ng-container [ngSwitch]="role">

          <!-- === ADMIN === -->
          <ng-container *ngSwitchCase="'ROLE_ADMIN'">

            <li class="nav-item">
              <a class="nav-link text-white d-flex justify-content-between align-items-center cursor-pointer" 
                 (click)="toggleSociosMenu()" 
                 style="cursor: pointer;">
                <span>
                  <i class="bi bi-people-fill me-2"></i> Socios
                </span>
                <i class="bi" [class.bi-chevron-down]="isSociosMenuOpen" [class.bi-chevron-right]="!isSociosMenuOpen"></i>
              </a>
              
              <!-- Submenú -->
              <ul class="nav flex-column ms-3" [class.d-none]="!isSociosMenuOpen">
                <li class="nav-item">
                  <!-- Filtro ACTIVO -->
                  <a routerLink="socios" [queryParams]="{estado: 'ACTIVO'}" routerLinkActive="active" 
                     class="nav-link text-white-50 small py-1">
                    <i class="bi bi-person-check me-2"></i> Activos
                  </a>
                </li>
                <li class="nav-item">
                  <!-- Filtro INACTIVO -->
                  <a routerLink="socios" [queryParams]="{estado: 'INACTIVO'}" routerLinkActive="active" 
                     class="nav-link text-white-50 small py-1">
                    <i class="bi bi-person-x me-2"></i> Inactivos
                  </a>
                </li>
                <li class="nav-item">
                  <!-- Ver Todos -->
                  <a routerLink="socios" [queryParams]="{}" routerLinkActive="active" 
                     [routerLinkActiveOptions]="{exact: true}"
                     class="nav-link text-white-50 small py-1">
                    <i class="bi bi-list-ul me-2"></i> Todos
                  </a>
                </li>
              </ul>
            </li>

            <li>
              <a routerLink="puestos" routerLinkActive="active" class="nav-link text-white sidebar-link">
                <i class="bi bi-shop me-2"></i> Puestos
              </a>
            </li>

            <li>
              <a routerLink="pagos" routerLinkActive="active" class="nav-link text-white sidebar-link">
                <i class="bi bi-cash-coin me-2"></i> Pagos
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link text-white d-flex justify-content-between align-items-center cursor-pointer" 
                 (click)="toggleMultasMenu()" style="cursor: pointer;">
                <span><i class="bi bi-exclamation-triangle-fill me-2"></i> Multas</span>
                <i class="bi" [class.bi-chevron-down]="isMultasMenuOpen" [class.bi-chevron-right]="!isMultasMenuOpen"></i>
              </a>
              
              <ul class="nav flex-column ms-3" [class.d-none]="!isMultasMenuOpen">
                <li class="nav-item">
                  <a routerLink="multas" [queryParams]="{estado: 'PENDIENTE'}" routerLinkActive="active" 
                     class="nav-link text-white-50 small py-1">
                    <i class="bi bi-hourglass-split me-2"></i> Pendientes
                  </a>
                </li>
                <li class="nav-item">
                  <a routerLink="multas" [queryParams]="{estado: 'PAGADO'}" routerLinkActive="active" 
                     class="nav-link text-white-50 small py-1">
                    <i class="bi bi-check-circle me-2"></i> Pagadas
                  </a>
                </li>
                <li class="nav-item">
                  <a routerLink="multas" [queryParams]="{}" routerLinkActive="active" 
                     [routerLinkActiveOptions]="{exact: true}"
                     class="nav-link text-white-50 small py-1">
                    <i class="bi bi-list-ul me-2"></i> Todas
                  </a>
                </li>
              </ul>
            </li>

            <li>
              <a routerLink="bienes" routerLinkActive="active" class="nav-link text-white sidebar-link">
                <i class="bi bi-box-seam me-2"></i> Bienes
              </a>
            </li>

          </ng-container>

          <!-- === SOCIO === -->
          <ng-container *ngSwitchCase="'ROLE_SOCIO'">

            <li>
              <a routerLink="mis-pagos" routerLinkActive="active" class="nav-link text-white sidebar-link">
                <i class="bi bi-receipt-cutoff me-2"></i> Mis Pagos
              </a>
            </li>

            <li>
              <a routerLink="mis-multas" routerLinkActive="active" class="nav-link text-white sidebar-link">
                <i class="bi bi-exclamation-diamond-fill me-2"></i> Mis Multas
              </a>
            </li>

          </ng-container>

        </ng-container>

      </ul>
      <hr>

    </aside>

    <!-- ===================== MAIN CONTENT ===================== -->
    <div class="d-flex flex-column flex-grow-1">

      <!-- Navbar superior -->
      <nav class="navbar navbar-light bg-white shadow-sm px-4">
        <div class="container-fluid">

          <span class="navbar-text fs-5">
            Hola, <strong>{{ (currentUserName$ | async) || 'Usuario' }}</strong>
          </span>

          <button (click)="logout()" class="btn btn-outline-danger">
            <i class="bi bi-box-arrow-right me-1"></i> Cerrar Sesión
          </button>

        </div>
      </nav>

      <!-- Contenido dinámico -->
      <main class="container-fluid p-4 bg-light overflow-auto" style="flex-grow: 1;">
        <router-outlet></router-outlet>
      </main>

    </div>

  </div>

</ng-container>
